<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>UCR Data Center - SSCECON207 workshop II:Workflow for data analysis in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">UCR Data Center</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../tutorials_old.html"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../courses.html"> 
<span class="menu-text">Courses</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../apprenticeship.html"> 
<span class="menu-text">Apprenticeship</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../ai.html"> 
<span class="menu-text">Generative AI</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../contact.html"> 
<span class="menu-text">Contact</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
    <a href="https://github.com/ucrdatacenter" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
    <a href="https://www.instagram.com/datacenterucr" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-instagram"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#learning-outcomes" id="toc-learning-outcomes" class="nav-link active" data-scroll-target="#learning-outcomes">Learning outcomes</a></li>
  <li><a href="#suggested-paper-workflow" id="toc-suggested-paper-workflow" class="nav-link" data-scroll-target="#suggested-paper-workflow">Suggested paper workflow</a></li>
  <li><a href="#importing-data" id="toc-importing-data" class="nav-link" data-scroll-target="#importing-data">Importing data</a>
  <ul class="collapse">
  <li><a href="#common-data-files" id="toc-common-data-files" class="nav-link" data-scroll-target="#common-data-files">Common data files</a>
  <ul class="collapse">
  <li><a href="#csv" id="toc-csv" class="nav-link" data-scroll-target="#csv">CSV</a></li>
  <li><a href="#other-delimited-text-files" id="toc-other-delimited-text-files" class="nav-link" data-scroll-target="#other-delimited-text-files">Other delimited text files</a></li>
  <li><a href="#other-data-formats" id="toc-other-data-formats" class="nav-link" data-scroll-target="#other-data-formats">Other data formats</a></li>
  </ul></li>
  <li><a href="#importing-data-files" id="toc-importing-data-files" class="nav-link" data-scroll-target="#importing-data-files">Importing data files</a>
  <ul class="collapse">
  <li><a href="#import-dataset-button" id="toc-import-dataset-button" class="nav-link" data-scroll-target="#import-dataset-button">Import dataset button</a></li>
  <li><a href="#own-import-code" id="toc-own-import-code" class="nav-link" data-scroll-target="#own-import-code">Own import code</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#data-cleaning" id="toc-data-cleaning" class="nav-link" data-scroll-target="#data-cleaning">Data cleaning</a>
  <ul class="collapse">
  <li><a href="#establishing-the-data-cleaning-steps" id="toc-establishing-the-data-cleaning-steps" class="nav-link" data-scroll-target="#establishing-the-data-cleaning-steps">Establishing the data cleaning steps</a></li>
  <li><a href="#wide-and-long-format" id="toc-wide-and-long-format" class="nav-link" data-scroll-target="#wide-and-long-format">Wide and long format</a></li>
  <li><a href="#renaming-variables" id="toc-renaming-variables" class="nav-link" data-scroll-target="#renaming-variables">Renaming variables</a></li>
  <li><a href="#selecting-and-filtering-data" id="toc-selecting-and-filtering-data" class="nav-link" data-scroll-target="#selecting-and-filtering-data">Selecting and filtering data</a></li>
  <li><a href="#modifying-variables-and-creating-new-variables" id="toc-modifying-variables-and-creating-new-variables" class="nav-link" data-scroll-target="#modifying-variables-and-creating-new-variables">Modifying variables and creating new variables</a></li>
  <li><a href="#efficient-pipe-workflows" id="toc-efficient-pipe-workflows" class="nav-link" data-scroll-target="#efficient-pipe-workflows">Efficient pipe workflows</a></li>
  </ul></li>
  <li><a href="#merging-datasets" id="toc-merging-datasets" class="nav-link" data-scroll-target="#merging-datasets">Merging datasets</a></li>
  <li><a href="#more-plotting-with-ggplot" id="toc-more-plotting-with-ggplot" class="nav-link" data-scroll-target="#more-plotting-with-ggplot">More plotting with <code>ggplot</code></a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">SSCECON207 workshop II:<br>Workflow for data analysis in R</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">Invalid Date</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="learning-outcomes" class="level1">
<h1>Learning outcomes</h1>
<p>In this tutorial you learn some more advanced functions in R to build on the first Data Center workshop. The tutorial focuses on finding, importing and cleaning data: an example of the steps you might take in order to prepare your data for writing an empirical paper. You can use these skills to create figures that you can incorporate in your final paper for the course.</p>
</section>
<section id="suggested-paper-workflow" class="level1">
<h1>Suggested paper workflow</h1>
<p>Before you start working with data, you should make sure to develop a good research question that you think can be answered using a combination of academic literature and available data. Once you have your research question, you should think about how you could use data to complement your theory: e.g.&nbsp;if your hypothesis is a relationship between two variables, your data analysis can focus on creating visuals that display whether there actually is a relationship between the two variables in a given sample. Then you can interpret these visuals to reach conclusions about whether the relationships that you expect to be present in your data are actually there.</p>
<p>Once you have an idea of what data you would need, you can start looking for it. Several useful data sources are listed <a href="https://ucrdatacenter.github.io/archive/SSCECON207_2022h1#Supporting_materials13">here</a>; additionally you can always simply Google the indicator that you are looking for. If you are looking for data from a single country, national statistical offices might be useful; if you are looking for data from multiple countries, international organizations such as the World Bank or OECD, or initiatives such as Our World in Data often have comprehensive global data.</p>
<p>Once you find, import and visualize your data, you can incorporate the results in your paper. Your paper should start with an introduction and literature review where you present your research question, including your theoretical justification behind your hypothesis/hypotheses. Next, you should present your data and analysis process in your Methods section: make sure you properly cite your data sources and explain the steps of your data analysis. Your Methods should be concise, but contain enough information that a reader could replicate your analysis. Your results section should present not only the results of your data analysis, but also your interpretation of whether those results align with your theoretical expectations and why/why not. Finally, a concluding section should breifly summarize your results, and point out any limitations and recommendations for future research.</p>
<p>To make the process of writing your paper easier, it is important to keep track of your files properly. You should create a new R project for your data analysis, and store all of your data files, scrips and results in that folder. If you don’t remember how to create a new R project, please refer to the handout of the previous Data Center workshop.</p>
<p>This tutorial focuses on the process of how to import datasets and clean them so they are ready for visualization. However, if you are struggling to find appropriate datasets or have questions regarding data visualization, feel free to reach out to the Data Center (or attend office hours) to get help with those components as well.</p>
<p>In the following we will work with two data files:</p>
<ul>
<li>GDP from the <a href="https://data.oecd.org/gdp/gross-domestic-product-gdp.htm">OECD database</a></li>
<li>CO2 emissions from the <a href="https://data.worldbank.org/indicator/EN.ATM.CO2E.PC">World Bank Database</a></li>
</ul>
<p>The goal is to import both files, clean them, and combine them into a single dataset that can be used to analyze the relationship between the two indicators. Your data analysis process might differ from this demonstration depending on your research question, but you will nevertheless be able to adapt (parts of) this workflow for your own paper.</p>
</section>
<section id="importing-data" class="level1">
<h1>Importing data</h1>
<p>For your paper you will draw data from a variety of online sources. Each source that you use has their own conventions of storing data, so you have to be able to import multiple kinds of data files into R.</p>
<section id="common-data-files" class="level2">
<h2 class="anchored" data-anchor-id="common-data-files">Common data files</h2>
<section id="csv" class="level3">
<h3 class="anchored" data-anchor-id="csv">CSV</h3>
<p>CSV files are a convenient and simple way of storing data. CSV stands for “comma-separated values”: the raw data is text file where each line of text is a row of data, and values within a row are separated by commas. In most cases your computer will automatically open CSV files in Excel, where they are displayed as a table. CSV files are the most common and also one of the easiest to import to R.</p>
</section>
<section id="other-delimited-text-files" class="level3">
<h3 class="anchored" data-anchor-id="other-delimited-text-files">Other delimited text files</h3>
<p>If data is stored as text, the value separator (also known as delimiter) does not always a comma. Other common delimiters are semicolons (;) and tabs (whitespace). The most common file extensions for these files are .csv (for semicolon-delimited files), .tsv or .txt. These files often cannot be displayed as a table by simply opening the file, but you can observe their structure by opening them as text files.</p>
</section>
<section id="other-data-formats" class="level3">
<h3 class="anchored" data-anchor-id="other-data-formats">Other data formats</h3>
<p>Sometimes data is provided in a way that uses the specific data formats of various statistical softwares. The most common formats are Excel files (.xlsx or .xls extensions), SPSS files (.sav extension), and Stata files (.dta estension). You can import these files and work with them in R even if you don’t have e.g.&nbsp;SPSS or Stata installed.</p>
</section>
</section>
<section id="importing-data-files" class="level2">
<h2 class="anchored" data-anchor-id="importing-data-files">Importing data files</h2>
<section id="import-dataset-button" class="level3">
<h3 class="anchored" data-anchor-id="import-dataset-button">Import dataset button</h3>
<p>You always import data by using various <code>read_...()</code> functions. The last Data Center workshop already showed you the simplest use of <code>read_csv("filename.csv")</code>.</p>
<p>When working with other data sources (especially if you are unsure about the structure of the data), you can let R do most of the work instead of figuring out the right functions and arguments yourself. Of course, if you are more comfortable with R, you will find it much more convenient to write your own importing code, as it is very straightforward to do so.</p>
<p>Before importing data to R, you need to download it to your computer. In most cases you will find clear instructions on how to do so on the website of the data source.</p>
<p>You can find GDP data in the OECD database <a href="https://data.oecd.org/gdp/gross-domestic-product-gdp.htm">here</a>. In order to download the data file, you need to find the blue “download” button directly above the displayed data, and choose the option “Full indicator data (.csv)”. The file will most likely be saved to your Downloads folder. In order to import it to R, you should first move it to your project folder.</p>
<p>Once done, you should repeat the process for the CO2 emissions data from the World Bank database. You can find the data <a href="https://data.worldbank.org/indicator/EN.ATM.CO2E.PC">here</a>; the “download” button on the right. Usually if CSV is available as a download option, you should use that, as CSV files are the most convenient to import. For the purposes of learning how to import other files, download the data as an Excel file. Again, the data will likely be saved in your Downloads folder. You should find it and move it to your project folder.</p>
<p>In order to import both files to R, open your project in RStudio. Find File -&gt; Import dataset in the top left of RStudio.</p>
<p>The GDP data is in CSV format, which is a form of text file, so select the option “from text (readr)”. <code>readr</code> is a tidyverse library, so it is preferred over <code>base</code> import functions. In the data import pop-up window click “Browse” and find the GDP data that you moved to your project folder. RStudio will try to automatically detect the format of your data: the result of that is shown in the Data preview window. If something looks wrong, try changing some of the settings below the data preview until the preview looks correct. Additionally, you should change the name of the data to something sensible, e.g.&nbsp;<code>GDP</code>. Once all the settings are ready, you can copy the contents of the “Code preview” window into your script, and use it to import your data. As long as you start your script by importing <code>tidyverse</code>, you don’t need to copy <code>library(readr)</code>, as <code>readr</code> is a part of <code>tidyverse</code>.</p>
<p>Importing the CO2 data is almost exactly the same, except you you should click File -&gt; Import Dataset -&gt; From Excel. Every following step is the same as with importing CSV files, except that you do need to load the <code>readxl</code> package separately, as it is not a part of <code>tidyverse</code>.</p>
<p>The result of copying the code should be similar to the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>GDP <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"DP_LIVE_14032022133237321.csv"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>CO2 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"API_EN.ATM.CO2E.PC_DS2_en_excel_v2_3732111.xls"</span>, <span class="at">skip =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="own-import-code" class="level3">
<h3 class="anchored" data-anchor-id="own-import-code">Own import code</h3>
<p>Later on you might find it more convenient to write your own importing code. In that case, you should be familiar with the most common packages, functions, and function arguments for importing data. You should also make sure to remember to assign each data file to an object so that they are stored in the RStudio environment.</p>
<p>CSV and other delimited text files can be imported using functions in the <code>tidyverse</code> package. CSV files can be easily imported using the <code>read_csv()</code> function; most of the time the only argument you need is the file path as a string. Other delimited files can be imported using the <code>read_delim()</code> function: there you need to specify both the file path to the data file and the delimiter as strings. The most common delimiters are semicolons (<code>delim = ";"</code>) and tabs (<code>delim = "\t"</code>). If your data has some special features, you might need to specify some additional arguments, such as <code>col_names = FALSE</code> if your data does not have column names, or <code>skip</code> if your data starts with non-data rows. You can find more information about these additional arguments in the help-files of <code>read_csv()</code> and <code>read_delim()</code>.</p>
<p>You can import Excel files using the <code>read_excel()</code> function from the <code>readxl</code> package. The function arguments are very similar to those of <code>read_csv()</code>: often it is enough to only specify the file path as a string, otherwise you can make use of the additional arguments. If your spreadsheet has multiple sheets, you also need to specify which sheet to import using he <code>sheet</code> argument.</p>
<p>If your data is a .sav or .dta file (SPSS or Stata data), you need the <code>haven</code> package to import data files. The functions you would need are <code>read_sav()</code> and <code>read_dta()</code>, and the main argument is still the file path as a string. Again, you can rely on the help-files of these functions for further explanation.</p>
<p>As long as you work in a project, you only need to specify relative file paths. If your data files are saved to your main project folder, then the relative file path is simply the file name (including the file extension, e.g.&nbsp;“data.csv”). If your data is in a subfolder within your project folder, then your relative file path must also include references to the subfolder(s), separated by slashes (/), e.g.&nbsp;as “data/data.csv”.</p>
</section>
</section>
</section>
<section id="data-cleaning" class="level1">
<h1>Data cleaning</h1>
<section id="establishing-the-data-cleaning-steps" class="level2">
<h2 class="anchored" data-anchor-id="establishing-the-data-cleaning-steps">Establishing the data cleaning steps</h2>
<p>Data files downloaded from online sources are not always in a convenient format for analysis in R: variable names are not always intuitive or consistent, you might need to make some additional calculations, recode variables, or remove some variables/observations. You can make a list of steps you need to take by observing the structure of your data.</p>
<p>To get a summary of the contents of your data file, you can use the <code>summary()</code> function as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(GDP)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   LOCATION          INDICATOR           SUBJECT            MEASURE         
 Length:4977        Length:4977        Length:4977        Length:4977       
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                            
                                                                            
                                                                            
  FREQUENCY              TIME          Value           Flag Codes       
 Length:4977        Min.   :1960   Min.   :     103   Length:4977       
 Class :character   1st Qu.:1987   1st Qu.:   16281   Class :character  
 Mode  :character   Median :2001   Median :   40756   Mode  :character  
                    Mean   :1998   Mean   :  941891                     
                    3rd Qu.:2011   3rd Qu.:  267339                     
                    Max.   :2021   Max.   :62794198                     </code></pre>
</div>
</div>
<p>This output shows you all the variables you have, including their type and some details about their content. In this case you can tell that the variable <code>TIME</code> specifies the year of the observation and <code>Value</code> contains the value of GDP for a given country and year. The other variables are all stored as character strings, so the <code>summary()</code> function is not particularly informative. To get more information about what data is stored in each column, you can view the data in RStudio’s data viewer using the <code>View()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(GDP)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Looking at the data shows that the variable <code>LOCATION</code> shows 3-digit country codes. <code>INDICATOR</code> is always “GDP”, <code>SUBJECT</code> is always “TOT”, and <code>FREQUENCY</code> is always “A”, so these variables do not contain useful information for data analysis. <code>MEASURE</code> has two options: “MLN_USD” and “USD_CAP”. In order to find out what these abbreviations mean, you need to go back to the website of the website of the data source. Reading the data documentation tells you that “MLN_USD” shows GDP in million US dollars, while “USD_CAP” shows GDP in US dollars/capita. You need to make a decision of which values to use: in this case let’s use GDP per capita. You will also discover that for your purposes the <code>FLAG</code> variable is not relevant.</p>
<p>You can repeat a similar process with the CO2 data (results omitted for conciseness):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(CO2)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(CO2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The data summary shows you that instead of having a variable for year, you have the data for each year in a separate column. Addionally, viewing the data will show you that the variable <code>Country Code</code> contains the same 3-digit country codes as the GDP data; keep this in mind as you will want to combine these datasets based on country matches. You will also find that you don’t need the variables <code>Country Name</code>, <code>Indicator Name</code> and <code>Indicator Code</code>.</p>
<p>In order to combine the datasets, you need to take some additional steps: you will need to turn the CO2 data from wide to long format so you have a single variable <code>year</code> and a single variable for the values for the values of CO2 emissions per country and year. Additionally, you want to rename your variables so they are consistent across datasets.</p>
</section>
<section id="wide-and-long-format" class="level2">
<h2 class="anchored" data-anchor-id="wide-and-long-format">Wide and long format</h2>
<p>The previous workshop already touched on the <code>pivot_longer()</code> function to convert from wide to long format. Remeber that the arguments that you need to specify are the columns you want to convert (in this case the years between 1960 and 2020), the variable name of the new column storing the years, and the variable name of the new column storing the values of CO2 emissions.</p>
<p>Note that if a column name in R starts with a number or includes spaces, you need to wrap it in backticks (`) when referring to them. Also note that a shortcut for referring to a range of columns is the format <code>first column of range:last column of range</code>. So in order to select the range of year columns you will need to specify the <code>pivot_longer()</code> function as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>CO2_longer <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(CO2, <span class="at">cols =</span> <span class="st">`</span><span class="at">1960</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">2020</span><span class="st">`</span>, <span class="at">names_to =</span> <span class="st">"year"</span>, <span class="at">values_to =</span> <span class="st">"CO2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Viewing the results shows that indeed you now have a variable <code>year</code> for year and a variable <code>CO2</code> for the value of CO2 emissions.</p>
</section>
<section id="renaming-variables" class="level2">
<h2 class="anchored" data-anchor-id="renaming-variables">Renaming variables</h2>
<p>While now the datasets are in a similar format, the variable names are still not consistent across datasets or convenient to work with. This problem can be easily fixed using the <code>rename()</code> function, which has the format <code>rename(data, "new_name" = "old_name")</code>. Since the variables <code>year</code> and <code>CO2</code> were already renamed when creating the object <code>CO2_longer</code>, we can use that data and only rename the variable <code>Country Code</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>GDP_renamed <span class="ot">&lt;-</span> <span class="fu">rename</span>(GDP,</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"country"</span> <span class="ot">=</span> <span class="st">"LOCATION"</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"year"</span> <span class="ot">=</span> <span class="st">"TIME"</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"GDP"</span> <span class="ot">=</span> <span class="st">"Value"</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>CO2_renamed <span class="ot">&lt;-</span> <span class="fu">rename</span>(CO2_longer,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"country"</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Country Code</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="selecting-and-filtering-data" class="level2">
<h2 class="anchored" data-anchor-id="selecting-and-filtering-data">Selecting and filtering data</h2>
<p>The previous workshop already covered the <code>select()</code> function to only keep certain variables, and the <code>filter()</code> function to filter only relevant observations. Remember that both datasets have unnecessary variables that should be removed, and that you want to only use GDP/capita and not GDP in million US dollars.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>GDP_final <span class="ot">&lt;-</span> GDP_renamed <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(MEASURE <span class="sc">==</span> <span class="st">"USD_CAP"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country, year, GDP)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>CO2_final <span class="ot">&lt;-</span> CO2_renamed <span class="sc">%&gt;%</span> </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country, year, CO2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you don’t remember how to use the pipe (<code>%&gt;%</code>), or how to specify the arguments of <code>select()</code> and <code>filter()</code>, refer back to the materials of the previous Data Center workshop.</p>
<p>Sometimes you need to specify multiple arguments in a <code>filter()</code> function, connected using logical operators. Think e.g.&nbsp;if you want to specify to only keep observations from one of two countries and for a given time period. Then your argument could be stated as “country is USA or country is UK and year is more than 1990 and year is less than 2010”. To turn this statement into a correct argument, you need to use the logical operators AND (in R <code>&amp;</code>) and OR (in R <code>|</code>). Additonally, you will need the operators <code>==</code> (equal), <code>!=</code> (not equal), <code>&gt;,&gt;=,&lt;=,&lt;</code>, and <code>%in%</code> (is one of). For example, the statement above could be written as <code>(country == "USA" | country == "UK") &amp; year &gt; 1990 &amp; year &lt; 2010</code>. Parentheses make sure that the logical order of the arguments is correct and helps with readability.</p>
<p>Instead of specifying every country from a list, you can use the <code>%in%</code> operator, followed by a vector as a shortcut. That statement would be evaluated as true if the value of the filtered variable matched with any of the elements of the vector. For example the argument <code>country %in% c("USA", "UK")</code> would keep every observation where the value of the variable <code>country</code> is either “USA” or “UK”. Remember that you can create vectors by listing the elements separated by commas within a <code>c()</code> function; remember that you need to wrap strings in quotation marks.</p>
</section>
<section id="modifying-variables-and-creating-new-variables" class="level2">
<h2 class="anchored" data-anchor-id="modifying-variables-and-creating-new-variables">Modifying variables and creating new variables</h2>
<p>In some cases you might need to do additional calculations with your data. For example, maybe your data has absolute values but you want to use growth rates, or you want to calculate the average values of a variable over time. Helpful functions in this case are the following:</p>
<ul>
<li><code>mutate()</code>: to create new variables (or modify existing variables) using functions or calculations - think of it as adding a new column to your data frame.</li>
<li><code>summarize()</code>: to create new variables using functions, using all rows from your data frame (or from a part of your data frame) - think e.g.&nbsp;if you have a data frame of GDP data from 20 years, and you want to calculate the average value of GDP in this dataset.</li>
<li><code>group_by()</code>: to specify grouping variables before using <code>mutate()</code> or <code>summarize()</code> - think e.g.&nbsp;if you have GDP data from 20 years from two countries, and you want to calculate average GDP over time separately for the two countries.</li>
</ul>
<p>An important use of <code>mutate()</code> is to make sure that all the variables in your two data frames ar compatible types with each other. For example, if both data frames have a variable called <code>year</code>, then you need to make sure that both variables are treated as numbers, otherwise you won’t be able to match them.</p>
<p>You can check the types of your variables by using the <code>summary()</code> function on your final two data frames:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(GDP_final)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   country               year           GDP        
 Length:2424        Min.   :1960   Min.   :   103  
 Class :character   1st Qu.:1988   1st Qu.:  8736  
 Mode  :character   Median :2001   Median : 18454  
                    Mean   :1999   Mean   : 22428  
                    3rd Qu.:2011   3rd Qu.: 31840  
                    Max.   :2021   Max.   :131503  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(CO2_final)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   country              year                CO2          
 Length:16226       Length:16226       Min.   : -0.0201  
 Class :character   Class :character   1st Qu.:  0.4706  
 Mode  :character   Mode  :character   Median :  1.7503  
                                       Mean   :  4.1049  
                                       3rd Qu.:  5.7996  
                                       Max.   :101.0532  
                                       NA's   :2910      </code></pre>
</div>
</div>
<p>When the summaries are displayed, you can immediately see that in <code>GDP_final</code> year is treated as a number, but in <code>CO2_final</code> it is treated as a character. Based on this result, you should reach the conclusion that you need to transform the variable <code>year</code> in <code>CO2_final</code> to be of type numberic. You can achieve that using the <code>as.numeric()</code> function within a <code>mutate()</code> function as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>CO2_final <span class="ot">&lt;-</span> <span class="fu">mutate</span>(CO2_final, <span class="at">year =</span> <span class="fu">as.numeric</span>(year))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice that I assign the resulting object to an object with the same name as the input data frame. This way I am overwriting the data frame previously saved as <code>CO2_final</code>. As the argument of the mutate function I specify that I want to create a variable <code>year</code>, and I assign the results of the function <code>as.numeric(year)</code> to the variable <code>year</code>. <code>as.numeric(year)</code> simply converts the numbers currently stored as characters to be stored as numbers. Since the variable <code>year</code> already exists in the data frame, it will be overwritten.</p>
<p>Now if you look at the summary of <code>CO2_final</code> again, you will see that <code>year</code> is treated as a number, which matches with the <code>year</code> variable of <code>GDP_final</code>, so the two datasets can be combined.</p>
<p>In case you would like to know more about how to use the <code>mutate()</code>, <code>summarize()</code> and <code>group_by()</code> functions to modify your data, please read the help-files of the functions and look at the relevant supporting materials listed on the Data Center website.</p>
</section>
<section id="efficient-pipe-workflows" class="level2">
<h2 class="anchored" data-anchor-id="efficient-pipe-workflows">Efficient pipe workflows</h2>
<p>Notice that you could have combined the entire data cleaning process into two clean pipe workflows. It is good practice to use pipe workflows when cleaning your data, as it will make it easier to keep track of your work and fix any issues. Remember that you can think of the pipe as an operator that takes the output of a function as the input of the following function. Don’t forget to assign the resulting data frames to sensibly named objects.</p>
<p>The following code produces the same final result as the code introduced previously, but without creating any intermediate objects (such as <code>GDP_renamed</code>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>GDP_final <span class="ot">&lt;-</span> GDP <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"country"</span> <span class="ot">=</span> <span class="st">"LOCATION"</span>, <span class="st">"year"</span> <span class="ot">=</span> <span class="st">"TIME"</span>, <span class="st">"GDP"</span> <span class="ot">=</span> <span class="st">"Value"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(MEASURE <span class="sc">==</span> <span class="st">"USD_CAP"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country, year, GDP)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>CO2_final <span class="ot">&lt;-</span> CO2 <span class="sc">%&gt;%</span> </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="st">`</span><span class="at">1960</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">2020</span><span class="st">`</span>, </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"year"</span>, <span class="at">values_to =</span> <span class="st">"CO2"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"country"</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Country Code</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country, year, CO2) <span class="sc">%&gt;%</span> </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(year))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="merging-datasets" class="level1">
<h1>Merging datasets</h1>
<p>Now that your two data frames follow the same structure, they can be combined into a single data frame that you can use to visualize the relationship between the two variables.</p>
<p>There are multiple ways to combine data frames. The simplest is row-binding: there you take two data frames that have the same variables, and basically place one below the other. For example, if you have one data frame of GDP between 1990 and 2000, and another dataset of GDP between 2001-2020, you can row-bind them with the code <code>GPD_full &lt;- bind_rows(GDP_1990_2000, GDP_2001_2020)</code>. Then your resulting data frame will have a row for year, where each row contains the value of GDP corresponding to that year.</p>
<p>However, most of the time you need something more complicated than row-binding. Take the two datasets that we have been working with so far: your entities are defined by the country and the year; one of your data frames contains the values of GDP corresponding to an entity (a country-year pair; e.g.&nbsp;GDP in the US in 2015), and the other data frame has the values of CO2 emissions corresponding to an entity defined in the same way. To look at the relationship between these values, you need to match them based on entity (so e.g.&nbsp;GDP in the US in 2015 is in the same row as CO2 emissions in the US in 2015).</p>
<p>The group of functions that accomplished these matches is the <code>..._join()</code> functions. There are four join functions: <code>full_join()</code>, <code>inner_join()</code>, <code>left_join()</code>, and <code>right_join()</code>. These functions all have the exact same structure and arguments; if the entities of your two data frames match perfectly (i.e.&nbsp;there are no entities that appear in one data frame but not in another), then the result of using any of the join functions is equivalent.</p>
<p>If there are entities that appear in one data frame but not in another (which you will likely encounter), then there is a difference in which entities appear in your final data frame depending on the type of join you use:</p>
<ul>
<li><code>full_join()</code> keeps every entity that appears in at least one of the data frames</li>
<li><code>inner_join()</code> keeps only entites that appear in both of your data frames</li>
<li><code>left_join()</code> keeps all entities that appear in your first data frame, even if they don’t appear in your second data frame</li>
<li><code>right_join()</code> keeps all entities that appear in your second data frame, even if they don’t appear in your first data frame</li>
</ul>
<p>For the most part, you can ignore these differences, and simply use <code>full_join()</code> to match your data frames. While doing so will likely create missing values, for your purposes that is not particularly relevant: when plotting the data, R will automatically exclude missing values.</p>
<p>In order to use any join function, you need to specify two main arguments: the two data frames that you are combining (separated by commas), and the variable(s) defining each entity. In this case, we are combining the data frames <code>GDP_final</code> and <code>CO2_final</code>. The variables defining each entity are <code>country</code> and <code>year</code>. If your entity variables have the same name in both of your data frames, and there are no other matching variable names, then you don’t need to specify the variables defining each entity; R will detect them automatically.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>full_data <span class="ot">&lt;-</span> <span class="fu">full_join</span>(GDP_final, CO2_final) <span class="co"># if you named your entity variables well, this will work</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>full_data <span class="ot">&lt;-</span> <span class="fu">full_join</span>(GDP_final, CO2_final, </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"country"</span>, <span class="st">"year"</span>)) <span class="co"># is equivalent to the previous line, but explicitly specifies the matching variables</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that you have your combined data frame, you should view it to make sure everything looks correct:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(full_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="more-plotting-with-ggplot" class="level1">
<h1>More plotting with <code>ggplot</code></h1>
<!-- -r graph gallery -->
<!-- -example of how you'd go from having frequency data to having a finished histogram -->
<p>The previous Data Center workshop already showed you how to create scatterplots and time-series plots using the <code>ggplot()</code> function. Feel free to reuse (parts of) that code for your paper, as these two plot types are likely the ones most relevant for your paper as well.</p>
<p>If you would like to make some different types of plots, you will benefit from familiarizing yourself with the <a href="https://www.r-graph-gallery.com/">R Graph Gallery</a>. This website shows you an extremely wide range of possible plots that you can make in R, guiding you through the process and providing code for each plot type.</p>
<p>Let’s say you want to plot the distribution of your data (e.g.&nbsp;you have a list of countries and their GDP, and want to see the distribution of values). Neither a scatterplot nor a line chart is appropriate for that purpose. However, if you go to <a href="https://www.r-graph-gallery.com/">R Graph Gallery</a>, and find the category “Distribution”, you will see all the suitable plot types. Let’s say that out of that list, you decide that a histogram is what you’re looking for. If you click on its icon, you will see a wide range of histogram plots: usually it is a good option to start with the most basic option; if you want to change some additional features, do it after figuring out the basic setup. Once you click on a plot, you will find an explanation of how to make that plot, what settings you can change, and all the code necessary to create the plot. Feel free to copy as much of this code as you can, and edit it afterwards to fit with your data: e.g.&nbsp;change the names of the data frame and variables. If the original code assigns your figure to an object (e.g.&nbsp;<code>p &lt;- ggplot()...</code>), remove that part (so remove <code>p &lt;-</code>) and run the code without it in order to display your figure.</p>
<p>If you receive errors, try to interpret what they suggest you change; try to read some supplementary materials or Google the error message and see if that helps you figure out what went wrong; if you still can’t figure it out, please reach out to the Data Center to fix it together.</p>
<p>Good luck with your paper!</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 UCR Data Center  •  2025
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:datacenter@ucr.nl">
      <i class="bi bi-envelope" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/ucrdatacenter">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.instagram.com/datacenterucr">
      <i class="bi bi-instagram" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>