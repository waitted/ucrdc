<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-08-12">

<title>UCR Data Center - Data Center Apprenticeship: Introduction to data wrangling in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">UCR Data Center</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials_old.html"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../courses.html"> 
<span class="menu-text">Courses</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../apprenticeship.html"> 
<span class="menu-text">Apprenticeship</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../ai.html"> 
<span class="menu-text">Generative AI</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../contact.html"> 
<span class="menu-text">Contact</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
    <a href="https://github.com/ucrdatacenter" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
    <a href="https://www.instagram.com/datacenterucr" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-instagram"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#objectives" id="toc-objectives" class="nav-link active" data-scroll-target="#objectives">Objectives</a>
  <ul class="collapse">
  <li><a href="#why-r" id="toc-why-r" class="nav-link" data-scroll-target="#why-r">Why R?</a></li>
  <li><a href="#why-tidyverse" id="toc-why-tidyverse" class="nav-link" data-scroll-target="#why-tidyverse">Why <code>tidyverse</code>?</a></li>
  </ul></li>
  <li><a href="#introduction-to-r" id="toc-introduction-to-r" class="nav-link" data-scroll-target="#introduction-to-r">Introduction to R</a>
  <ul class="collapse">
  <li><a href="#objects-in-r" id="toc-objects-in-r" class="nav-link" data-scroll-target="#objects-in-r">Objects in R</a></li>
  <li><a href="#functions-in-r" id="toc-functions-in-r" class="nav-link" data-scroll-target="#functions-in-r">Functions in R</a></li>
  </ul></li>
  <li><a href="#importing-data" id="toc-importing-data" class="nav-link" data-scroll-target="#importing-data">Importing data</a></li>
  <li><a href="#data-wrangling" id="toc-data-wrangling" class="nav-link" data-scroll-target="#data-wrangling">Data wrangling</a>
  <ul class="collapse">
  <li><a href="#merging-datasets" id="toc-merging-datasets" class="nav-link" data-scroll-target="#merging-datasets">Merging datasets</a></li>
  <li><a href="#filtering-observations" id="toc-filtering-observations" class="nav-link" data-scroll-target="#filtering-observations">Filtering observations</a></li>
  <li><a href="#selecting-variables" id="toc-selecting-variables" class="nav-link" data-scroll-target="#selecting-variables">Selecting variables</a></li>
  <li><a href="#creating-new-variables" id="toc-creating-new-variables" class="nav-link" data-scroll-target="#creating-new-variables">Creating new variables</a></li>
  <li><a href="#sorting-the-data" id="toc-sorting-the-data" class="nav-link" data-scroll-target="#sorting-the-data">Sorting the data</a></li>
  <li><a href="#renaming-variables" id="toc-renaming-variables" class="nav-link" data-scroll-target="#renaming-variables">Renaming variables</a></li>
  <li><a href="#categorical-variables-as-factors" id="toc-categorical-variables-as-factors" class="nav-link" data-scroll-target="#categorical-variables-as-factors">Categorical variables as factors</a></li>
  <li><a href="#data-cleaning-as-a-single-pipeline" id="toc-data-cleaning-as-a-single-pipeline" class="nav-link" data-scroll-target="#data-cleaning-as-a-single-pipeline">Data cleaning as a single pipeline</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data Center Apprenticeship: Introduction to data wrangling in R</h1>
<p class="subtitle lead">January 2025</p>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 12, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="objectives" class="level1">
<h1>Objectives</h1>
<section id="why-r" class="level2">
<h2 class="anchored" data-anchor-id="why-r">Why R?</h2>
<ul>
<li>Free and open-source</li>
<li>Reproducible</li>
<li>Widely used in academia and industry; up-to-date with the latest technological developments</li>
<li>Very versatile: extensive package ecosystem for statistics and more</li>
<li>Powerful data wrangling and visualization capabilities</li>
<li>Extensive community support (open-access books, tutorials, forums, AI tools, etc.)</li>
</ul>
</section>
<section id="why-tidyverse" class="level2">
<h2 class="anchored" data-anchor-id="why-tidyverse">Why <code>tidyverse</code>?</h2>
<ul>
<li>Clean, consistent, intuitive, readable syntax for all steps of the data analysis process</li>
<li>Limited set of functions that can be combined in many ways</li>
<li>Many packages beyond core <code>tidyverse</code> with the same underlying design, grammar, and data structures, therefore easier to learn advanced techniques</li>
</ul>
</section>
</section>
<section id="introduction-to-r" class="level1">
<h1>Introduction to R</h1>
<section id="objects-in-r" class="level2">
<h2 class="anchored" data-anchor-id="objects-in-r">Objects in R</h2>
<p>One of the most basic types of objects in R is a vector. A vector is a collection of values of the same type, such as numbers, characters, or logicals (TRUE/FALSE). You can create a vector with the <code>c()</code> function, which stands for concatenate. If you assign a vector to an object with the assignment operator <code>&lt;-</code>, your vector will be saved in your environment so you can work with it within your current R session. Some examples of creating vectors are:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>v1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>)  <span class="co"># character vector with 3 elements</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>v2 <span class="ot">&lt;-</span> <span class="dv">25</span>                <span class="co"># numeric vector with 1 element</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>v3 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>              <span class="co"># numeric vector with 10 elements - integers from 1 to 10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To subset or extract elements from a vector, you can use square brackets <code>[ ]</code> with an index. For example, <code>v1[1]</code> returns the first element of <code>v1</code>, <code>v3[2:5]</code> returns the 2nd to 5th elements of <code>v3</code>, and <code>v3[-c(2, 4, 6)]</code> returns all but the 2nd, 4th and 6th elements of <code>v3</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>v1[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "A"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>v3[<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2 3 4 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>v3[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  1  3  5  7  8  9 10</code></pre>
</div>
</div>
<p>A dataframe (or “tibble” in <code>tidyverse</code>) is a special type of object that combines vectors into a rectangular table. Each column of a dataframe is a vector, and each row is an observation. usually you would load data from an external source, but you can create a dataframe with the <code>data.frame()</code> and a tibble with the <code>tibble()</code> function. You can also convert other data types such as matrices to tibbles with the <code>as_tibble()</code> function. Both functions take vectors as their arguments. Tibbles are preferred because they are more modern and have some convenient features that dataframes don’t, but for the most part, differences are minor and for the most part it does not matter whether you work with tibbles or dataframes.</p>
<p>A simple example of creating a tibble is (make sure to load <code>tidyverse</code> first):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># define vectors within the tibble() function</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"Alice"</span>, <span class="st">"Bob"</span>, <span class="st">"Chris"</span>),</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="fu">c</span>(<span class="dv">165</span>, <span class="dv">180</span>, <span class="dv">175</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  name  height
  &lt;chr&gt;  &lt;dbl&gt;
1 Alice    165
2 Bob      180
3 Chris    175</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define the vectors first, then combine them into a tibble</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>name <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alice"</span>, <span class="st">"Bob"</span>, <span class="st">"Chris"</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>height <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">165</span>, <span class="dv">180</span>, <span class="dv">175</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(name, height)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  name  height
  &lt;chr&gt;  &lt;dbl&gt;
1 Alice    165
2 Bob      180
3 Chris    175</code></pre>
</div>
</div>
</section>
<section id="functions-in-r" class="level2">
<h2 class="anchored" data-anchor-id="functions-in-r">Functions in R</h2>
<p>Functions are reusable pieces of code that perform a specific task. They take arguments as inputs and return one or more pieces of output. You will mostly work with functions loaded from various packages or from the base R distribution, and in some cases you may write your own functions to avoid repetition or improve the readability of your code. We will cover writing your own functions later in the program.</p>
<p>As with vectors, the output of a function is saved to your environment only if you assign the result to an object. For example, <code>sum(x)</code> will display the sum of the elements of the vector <code>x</code>, but <code>sum &lt;- sum(x)</code> will save this result to an object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">8</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 23</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>sum <span class="ot">&lt;-</span> <span class="fu">sum</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Some important functions on vectors are</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(x)   <span class="co"># return the mean; add the argument na.rm = TRUE if missing values should be excluded</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.833333</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(x) <span class="co"># give the length of the vector (number of elements)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(x) <span class="co"># list the unique elements of the vector</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 5 6 2 8</code></pre>
</div>
</div>
<p>To learn more about a function and its arguments, you can use the ? operator or the help() function, for example by typing <code>?sum</code> (or equivalently, <code>?sum()</code>). It is good practice to request help files from your console and not you R script, since there is no need to save these queries for the future.</p>
</section>
</section>
<section id="importing-data" class="level1">
<h1>Importing data</h1>
<p>R can handle practically any type of data, from simple text files to files used by other (not necessarily open-source) software and complex databases. This gives users a lot of flexibility in terms of data sources and formats.</p>
<p>In addition to using your own data (e.g.&nbsp;as exported from a survey), the Data Center keeps a continuously updated list of useful datasets by discipline, accessible <a href="../../../../tutorials/data">here</a>.</p>
<p>In the following, we’ll discuss how to import and export from and to various file formats, and discuss a number of available packages to do so.</p>
<p>Start by reading the introduction to importing the most common file types (text files, Excel, SPSS, Stata) <a href="../../../../tutorials/r_adv_import">here</a>. It is good to be aware of the Import dataset button and use it when needed, but in the long run it is easier to be aware of the available import functions and use them directly. The rest of this section gives more information and examples of importing data from different file formats and different levels of tidiness.</p>
<p>We will use the following packages for importing different file formats:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl) <span class="co"># for Excel</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven) <span class="co"># for SPSS, Stata, SAS</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In addition, the <code>rio</code> package provides a generic import function, however, it is simply a wrapper for many of the other import functions shown below. While it may be easier to use the same import function for many file formats, <code>rio</code> redirects you to the original functions if you look for the possible function arguments, therefore for debugging it is better practice to use the “original” functions. In some cases, <code>rio</code> can read URL file paths that <code>readr</code> and <code>readxl</code> can’t.</p>
<p>In the following, we’ll work with some example data of student characteristics and grades. First, download <a href="https://github.com/ucrdatacenter/projects/raw/refs/heads/main/apprenticeship/2025h1/student_data.zip">this</a> zip-file from GitHub, and extract it into a data folder within your apprenticeship project directory. We now import each file, explaining the packages, functions, and function arguments used. These files are all different subsets of the same dataset on student characteristics and grades at a university (<a href="https://www.kaggle.com/datasets/jacksondivakarr/student-classification-dataset?resource=download">original source</a>).</p>
<p><code>student1.csv</code> is a comma-separated text file. Opening it in a notepad or Excel shows that the column separators are commas (,). The <code>read_csv()</code> function from the previous workshop expects commas as a separator, while <code>read_csv2()</code> expects semicolons (common with e.g.&nbsp;Dutch language settings). Since CSV files are a form of delimited text files, we can also use the more versatile <code>read_delim()</code> function specifying the delimiter as the argument.</p>
<p>In the following, we use the <code>read_csv()</code> (and <code>read_delim()</code>) function to import the data, and assign the resulting object to an object called <code>student1</code> with the assignment operator <code>&lt;-</code>. The <code>student1</code> object is now a tibble in the R environment: you can find the object in the Environment tab in RStudio, and view the data by clicking on the object name or running <code>View(student1)</code> in the Console.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>student1 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/student1.csv"</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>student1 <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"data/student1.csv"</span>, <span class="at">delim =</span> <span class="st">","</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this case, we used <code>read_csv()</code> only specifying its one mandatory argument: the file path. When using <code>read_delim()</code>, we also specified an optional argument: we defined the delimiter as a comma, thereby overriding the default function behavior. To learn more about the mandatory and optional arguments of a function, and find out what the default behaviors are, you can use the <code>?</code> operator followed by the function name, e.g.&nbsp;<code>?read_delim</code> in the Console to open the help file of a function (or use the search bar of the Help tab).</p>
<p><code>student2.tab</code> is also a delimited text file. Opening it in a notepad shows that the delimiter is a tab. The notation for tab whitespace is <code>\t</code>, which we can specify in the <code>delim</code> argument. Like the “.tab” file extension, “.tsv” is also a tab-separated text file, so the more specialized <code>read_tsv()</code> function also works.</p>
<p>If you load this data without optional arguments, you’ll see that instead of the correct number of columns, we get a single column, with the variable name containing some metadata. To get the correct number of columns, we need to skip the first row of the data that contains this metadata, as the actual data starts from the second row. We can use the <code>skip</code> argument to skip the first row. If we use one of the relevant import functions, and assign the outcome to the <code>student2</code> object, we can see that the data is now correctly imported and shows up in the environment next to <code>student1</code> as another tibble.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>student2 <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"data/student2.tab"</span>, <span class="at">delim =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>student2 <span class="ot">&lt;-</span> <span class="fu">read_tsv</span>(<span class="st">"data/student2.tab"</span>, <span class="at">skip =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>student3.xlsx</code> is an Excel file. To import Excel file we need the <code>read_excel()</code> function from the <code>readxl</code> package (the <code>readxl</code> package is one of packages that is not a part of core <code>tidyverse</code> but uses the same principles). With the <code>read_excel()</code> function you can specify which sheet to use in addition to similar arguments as for delimited text files. Notice that by default R imports the “Metadata” sheet, so we can use the <code>sheet</code> argument to specify which sheet to import. In addition, the first two rows contain introductory text, not the data, so we can use the <code>skip</code> argument to skip those rows. You may also notice that previously the variable name for age was <code>Student_Age</code> and now it is <code>Student_age</code>. You can rename the variable either by giving a full list of column names in the import function, but often it is easier to use the <code>rename()</code> function after importing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>student3 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"data/student3.xlsx"</span>, <span class="at">sheet =</span> <span class="st">"Data"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>haven</code> package (also not core <code>tidyverse</code> but same principles) reads files in the data formats of SPSS (.sav) and Stata (.dta). It can also extract variable and value labels from these files; here we can use the <code>read_spss()</code> to import <code>student4.sav</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>student4 <span class="ot">&lt;-</span> <span class="fu">read_spss</span>(<span class="st">"data/student4.sav"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>RDS is an R-specific file format that saves all attributes of the dataframe (e.g.&nbsp;grouping, factor levels). It is particularly useful for saving intermediate data files, e.g.&nbsp;saving the cleaned data before analysis to avoid needing to run the data cleaning script repeatedly. To import an RDS file such as <code>student5.rds</code>, use the <code>read_rds()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>student5 <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/student5.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A few notes regarding importing and exporting data:</p>
<ul>
<li>Always make sure you know your current working directory and the relative path to your data directory. It is better to use relative rather than absolute file paths (i.e.&nbsp;<code>data/data.csv</code> instead of <code>C:/User/Project/data/data.csv</code>).</li>
<li>Note that if you are using Windows, you may need to replace the backslashes (\) in the file path with forward slashes (/) to avoid errors.</li>
<li>You can import files directly from URLs, although you usually need the URL of a raw file. If a file downloads immediately instead of opening in a raw format, you can try to copy that download link by right-clicking and selecting “Copy link address”; the <code>import()</code> function from <code>rio</code> might be successful with those links.</li>
<li>To export data from R, you can almost always use the <code>write_...()</code> function corresponding to the desired file format, e.g.&nbsp;<code>write_csv()</code>. For Excel files the preferred export function is <code>write_xlsx()</code>, and for SPSS’s .sav files it is <code>write_sav()</code>.</li>
<li>For other file formats, the generic <code>write()</code> function is useful; you can specify any file format, and if your input data is readable in the chosen format, the file will export properly.</li>
<li>In all <code>write_()</code> functions you need to specify the data you’d like to save and the output file path (absolute or relative) including chosen file extension.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># example export code</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(student1, <span class="st">"data/new_data.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-wrangling" class="level1">
<h1>Data wrangling</h1>
<p>Data wrangling is the process of cleaning, structuring, and enriching raw data into a more usable format. The <code>dplyr</code> package is a part of the <code>tidyverse</code> and provides a set of functions that can be combined to perform the most common data wrangling tasks. The package is built around the concept of the “grammar of data manipulation”, which is a consistent set of verbs that can be combined in many ways to achieve the desired result.</p>
<p>The main functions in <code>dplyr</code> are <code>filter()</code>, <code>select()</code>, <code>mutate()</code>, <code>arrange()</code>, <code>group_by()</code>, <code>summarize()</code>, and <code>rename()</code>. <code>dplyr</code> also provides a set of functions for combining datasets: <code>bind_rows()</code> and <code>bind_cols()</code> for row-wise and column-wise binding, and <code>left_join()</code>, <code>right_join()</code>, <code>inner_join()</code>, and <code>full_join()</code> for joining datasets based on common variables. These functions can be combined using the pipe operator <code>|&gt;</code> (or <code>%&gt;%</code>, they are mostly equivalent) to create a data wrangling workflow. The pipe operator takes the output of the function on its left and passes it as the first argument to the function on its right. This allows you to chain multiple functions together in a single line of code, making your code more readable and easier to understand.</p>
<p>In the following, we’ll work with the <code>student</code> datasets imported in the previous section and show how to use the main <code>dplyr</code> functions to clean the data so it is suitable for analysis. These steps are useful even if the input data is quite clean, as we often need to work with only a subset of observations/variables, define new variables, or aggregate the data.</p>
<section id="merging-datasets" class="level2">
<h2 class="anchored" data-anchor-id="merging-datasets">Merging datasets</h2>
<p>In our current application, we have five datasets that contain different observations of the same, larger dataset. So we can list all datasets in a row-binding function to combine them into a single dataset called <code>student</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>student <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(student1, student2, student3, student4, student5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the following, we’ll demonstrate the key data cleaning functions on this merged tibble.</p>
</section>
<section id="filtering-observations" class="level2">
<h2 class="anchored" data-anchor-id="filtering-observations">Filtering observations</h2>
<p>If we want to keep only a subset of observations, we can use the <code>filter()</code> function. We can specify a logical condition as the argument to <code>filter()</code>, and only observations that meet that condition will be kept. For example, to keep only students who are over 21 years old, we can use the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(student, Student_Age <span class="sc">&gt;</span> <span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 27 × 15
      Id Student_Age Sex    High_School_Type Scholarship Additional_Work
   &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;            &lt;chr&gt;       &lt;chr&gt;          
 1  5005          22 Male   Private          50%         No             
 2  5015          26 Male   State            75%         Yes            
 3  5016          22 Male   State            50%         No             
 4  5018          22 Male   State            50%         No             
 5  5023          22 Male   State            50%         Yes            
 6  5024          25 Male   State            25%         Yes            
 7  5029          24 Male   State            50%         No             
 8  5032          25 Male   State            50%         Yes            
 9  5040          22 Female State            50%         No             
10  5042          24 Male   State            50%         Yes            
# ℹ 17 more rows
# ℹ 9 more variables: Sports_activity &lt;chr&gt;, Transportation &lt;chr&gt;,
#   Weekly_Study_Hours &lt;dbl&gt;, Attendance &lt;chr&gt;, Reading &lt;chr&gt;, Notes &lt;chr&gt;,
#   Listening_in_Class &lt;chr&gt;, Project_work &lt;chr&gt;, Grade &lt;chr&gt;</code></pre>
</div>
</div>
<p>In a pipe workflow, the same code would look like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>student <span class="sc">|&gt;</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Student_Age <span class="sc">&gt;</span> <span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 27 × 15
      Id Student_Age Sex    High_School_Type Scholarship Additional_Work
   &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;            &lt;chr&gt;       &lt;chr&gt;          
 1  5005          22 Male   Private          50%         No             
 2  5015          26 Male   State            75%         Yes            
 3  5016          22 Male   State            50%         No             
 4  5018          22 Male   State            50%         No             
 5  5023          22 Male   State            50%         Yes            
 6  5024          25 Male   State            25%         Yes            
 7  5029          24 Male   State            50%         No             
 8  5032          25 Male   State            50%         Yes            
 9  5040          22 Female State            50%         No             
10  5042          24 Male   State            50%         Yes            
# ℹ 17 more rows
# ℹ 9 more variables: Sports_activity &lt;chr&gt;, Transportation &lt;chr&gt;,
#   Weekly_Study_Hours &lt;dbl&gt;, Attendance &lt;chr&gt;, Reading &lt;chr&gt;, Notes &lt;chr&gt;,
#   Listening_in_Class &lt;chr&gt;, Project_work &lt;chr&gt;, Grade &lt;chr&gt;</code></pre>
</div>
</div>
<p>We can also apply logical conditions to character variables, e.g.&nbsp;to keep only students who went to a private high school and who did not receive a failing grade. Filters can be combined with AND (<code>,</code> or <code>&amp;</code>) and OR (<code>|</code>) operators into a single function. Note the use of quotation marks around the character values in the logical condition and the double equal sign <code>==</code> to denote equality.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>student <span class="sc">|&gt;</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(High_School_Type <span class="sc">==</span> <span class="st">"Private"</span>, Grade <span class="sc">!=</span> <span class="st">"Fail"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 23 × 15
      Id Student_Age Sex    High_School_Type Scholarship Additional_Work
   &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;            &lt;chr&gt;       &lt;chr&gt;          
 1  5004          18 Female Private          50%         Yes            
 2  5005          22 Male   Private          50%         No             
 3  5011          18 Female Private          50%         No             
 4  5020          18 Male   Private          50%         No             
 5  5028          18 Male   Private          50%         Yes            
 6  5035          18 Male   Private          50%         No             
 7  5036          18 Male   Private          75%         No             
 8  5041          18 Male   Private          50%         No             
 9  5050          18 Male   Private          75%         No             
10  5077          20 Male   Private          25%         No             
# ℹ 13 more rows
# ℹ 9 more variables: Sports_activity &lt;chr&gt;, Transportation &lt;chr&gt;,
#   Weekly_Study_Hours &lt;dbl&gt;, Attendance &lt;chr&gt;, Reading &lt;chr&gt;, Notes &lt;chr&gt;,
#   Listening_in_Class &lt;chr&gt;, Project_work &lt;chr&gt;, Grade &lt;chr&gt;</code></pre>
</div>
</div>
<p>Another useful logical operator is <code>%in%</code>, which allows you to filter observations based on a list of values. For example, to keep only students who receive either 75% or 100% scholarships, we can use the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>student <span class="sc">|&gt;</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Scholarship <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"75%"</span>, <span class="st">"100%"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 65 × 15
      Id Student_Age Sex    High_School_Type Scholarship Additional_Work
   &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;            &lt;chr&gt;       &lt;chr&gt;          
 1  5007          18 Male   State            75%         No             
 2  5012          18 Female Private          75%         Yes            
 3  5013          18 Female Private          75%         No             
 4  5014          19 Female State            100%        No             
 5  5015          26 Male   State            75%         Yes            
 6  5017          18 Female State            100%        No             
 7  5019          18 Female State            75%         No             
 8  5021          18 Male   State            100%        Yes            
 9  5022          18 Male   State            100%        No             
10  5030          19 Male   Other            75%         No             
# ℹ 55 more rows
# ℹ 9 more variables: Sports_activity &lt;chr&gt;, Transportation &lt;chr&gt;,
#   Weekly_Study_Hours &lt;dbl&gt;, Attendance &lt;chr&gt;, Reading &lt;chr&gt;, Notes &lt;chr&gt;,
#   Listening_in_Class &lt;chr&gt;, Project_work &lt;chr&gt;, Grade &lt;chr&gt;</code></pre>
</div>
</div>
</section>
<section id="selecting-variables" class="level2">
<h2 class="anchored" data-anchor-id="selecting-variables">Selecting variables</h2>
<p>If we want to keep only a subset of variables, we can use the <code>select()</code> function. We can specify the variables we want to keep (or exclude, with <code>-</code> signs) as the arguments to <code>select()</code>, and only those variables will be kept. For example, to keep only the <code>Id</code> and <code>Student_Age</code> variables, we can use the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(student, Id, Student_Age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 145 × 2
      Id Student_Age
   &lt;dbl&gt;       &lt;dbl&gt;
 1  5001          21
 2  5002          20
 3  5003          21
 4  5004          18
 5  5005          22
 6  5006          20
 7  5007          18
 8  5008          18
 9  5009          19
10  5010          21
# ℹ 135 more rows</code></pre>
</div>
</div>
<p>We can also select columns based on their location in the dataframe or by looking for patterns in the column names:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(student, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) <span class="co"># select the first three columns</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 145 × 3
      Id Student_Age Sex   
   &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt; 
 1  5001          21 Male  
 2  5002          20 Male  
 3  5003          21 Male  
 4  5004          18 Female
 5  5005          22 Male  
 6  5006          20 Male  
 7  5007          18 Male  
 8  5008          18 Female
 9  5009          19 Female
10  5010          21 Female
# ℹ 135 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(student, <span class="fu">starts_with</span>(<span class="st">"Student"</span>)) <span class="co"># select columns that start with "Student"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 145 × 1
   Student_Age
         &lt;dbl&gt;
 1          21
 2          20
 3          21
 4          18
 5          22
 6          20
 7          18
 8          18
 9          19
10          21
# ℹ 135 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(student, <span class="sc">-</span>Grade) <span class="co"># keep everything but "Grade"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 145 × 14
      Id Student_Age Sex    High_School_Type Scholarship Additional_Work
   &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;            &lt;chr&gt;       &lt;chr&gt;          
 1  5001          21 Male   Other            50%         Yes            
 2  5002          20 Male   Other            50%         Yes            
 3  5003          21 Male   State            50%         No             
 4  5004          18 Female Private          50%         Yes            
 5  5005          22 Male   Private          50%         No             
 6  5006          20 Male   State            50%         No             
 7  5007          18 Male   State            75%         No             
 8  5008          18 Female State            50%         Yes            
 9  5009          19 Female Other            50%         No             
10  5010          21 Female State            50%         No             
# ℹ 135 more rows
# ℹ 8 more variables: Sports_activity &lt;chr&gt;, Transportation &lt;chr&gt;,
#   Weekly_Study_Hours &lt;dbl&gt;, Attendance &lt;chr&gt;, Reading &lt;chr&gt;, Notes &lt;chr&gt;,
#   Listening_in_Class &lt;chr&gt;, Project_work &lt;chr&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(student, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">6</span>, <span class="dv">10</span>)) <span class="co"># keep everything but the 2nd, 6th, and 10th columns</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 145 × 12
      Id Sex    High_School_Type Scholarship Sports_activity Transportation
   &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;            &lt;chr&gt;       &lt;chr&gt;           &lt;chr&gt;         
 1  5001 Male   Other            50%         No              Private       
 2  5002 Male   Other            50%         No              Private       
 3  5003 Male   State            50%         No              Private       
 4  5004 Female Private          50%         No              Bus           
 5  5005 Male   Private          50%         No              Bus           
 6  5006 Male   State            50%         No              Private       
 7  5007 Male   State            75%         No              Private       
 8  5008 Female State            50%         Yes             Bus           
 9  5009 Female Other            50%         Yes             Bus           
10  5010 Female State            50%         No              Bus           
# ℹ 135 more rows
# ℹ 6 more variables: Weekly_Study_Hours &lt;dbl&gt;, Reading &lt;chr&gt;, Notes &lt;chr&gt;,
#   Listening_in_Class &lt;chr&gt;, Project_work &lt;chr&gt;, Grade &lt;chr&gt;</code></pre>
</div>
</div>
<p>A pipe workflow allows us to combine the filtering and selecting operations into a single, step-by-step workflow:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>student <span class="sc">|&gt;</span> </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Student_Age <span class="sc">&gt;</span> <span class="dv">21</span>) <span class="sc">|&gt;</span> </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Id, Student_Age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 27 × 2
      Id Student_Age
   &lt;dbl&gt;       &lt;dbl&gt;
 1  5005          22
 2  5015          26
 3  5016          22
 4  5018          22
 5  5023          22
 6  5024          25
 7  5029          24
 8  5032          25
 9  5040          22
10  5042          24
# ℹ 17 more rows</code></pre>
</div>
</div>
</section>
<section id="creating-new-variables" class="level2">
<h2 class="anchored" data-anchor-id="creating-new-variables">Creating new variables</h2>
<p>If we want to create a new variable based on existing variables, we can use the <code>mutate()</code> function. We can specify the new variable name and the calculation for the new variable as the arguments to <code>mutate()</code>, and the new variable will be added to the dataset. For example, we can create a new variable <code>Daily_Study_Hours</code> that divides <code>Weekly_Study_Hours</code> by 5, a new variable <code>Class_Participation</code> that is a logical variable indicating whether the student has at least one “Yes” answer for reading, listening, and taking notes, and a new variable <code>Scholarship_num</code> that extracts the numeric value of <code>Scholarship</code> if the string contains a number.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>student <span class="sc">|&gt;</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create new variables</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Daily_Study_Hours =</span> Weekly_Study_Hours <span class="sc">/</span> <span class="dv">5</span>,</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">Class_Participation =</span> Reading <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">|</span> Listening_in_Class <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">|</span> Notes <span class="sc">==</span> <span class="st">"Yes"</span>,</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">Scholarship_num =</span> <span class="fu">parse_number</span>(Scholarship)) <span class="sc">|&gt;</span> </span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># show only ID and the new variables</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Id, Daily_Study_Hours, Class_Participation, Scholarship_num)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 145 × 4
      Id Daily_Study_Hours Class_Participation Scholarship_num
   &lt;dbl&gt;             &lt;dbl&gt; &lt;lgl&gt;                         &lt;dbl&gt;
 1  5001               0   TRUE                             50
 2  5002               0   TRUE                             50
 3  5003               0.4 FALSE                            50
 4  5004               0.4 TRUE                             50
 5  5005               2.4 TRUE                             50
 6  5006               0.4 TRUE                             50
 7  5007               0   TRUE                             75
 8  5008               0.4 TRUE                             50
 9  5009               0   FALSE                            50
10  5010               2.4 TRUE                             50
# ℹ 135 more rows</code></pre>
</div>
</div>
</section>
<section id="sorting-the-data" class="level2">
<h2 class="anchored" data-anchor-id="sorting-the-data">Sorting the data</h2>
<p>If we want to sort the data based on one or more variables, we can use the <code>arrange()</code> function, taking the tibble and a variable list as its arguments. By default, <code>arrange()</code> sorts in ascending order, but you can specify descending order by using the <code>desc()</code> function. For example, to sort the data by <code>Student_Age</code> in descending order, and <code>Weekly_Study_Hours</code> in ascending order, we can use the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>student <span class="sc">|&gt;</span> </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Student_Age), Weekly_Study_Hours)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 145 × 15
      Id Student_Age Sex    High_School_Type Scholarship Additional_Work
   &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;            &lt;chr&gt;       &lt;chr&gt;          
 1  5118          26 Female Private          50%         No             
 2  5015          26 Male   State            75%         Yes            
 3  5032          25 Male   State            50%         Yes            
 4  5056          25 Male   State            50%         Yes            
 5  5024          25 Male   State            25%         Yes            
 6  5029          24 Male   State            50%         No             
 7  5082          24 Male   State            50%         Yes            
 8  5042          24 Male   State            50%         Yes            
 9  5085          24 Male   Other            50%         Yes            
10  5059          23 Male   State            50%         No             
# ℹ 135 more rows
# ℹ 9 more variables: Sports_activity &lt;chr&gt;, Transportation &lt;chr&gt;,
#   Weekly_Study_Hours &lt;dbl&gt;, Attendance &lt;chr&gt;, Reading &lt;chr&gt;, Notes &lt;chr&gt;,
#   Listening_in_Class &lt;chr&gt;, Project_work &lt;chr&gt;, Grade &lt;chr&gt;</code></pre>
</div>
</div>
</section>
<section id="renaming-variables" class="level2">
<h2 class="anchored" data-anchor-id="renaming-variables">Renaming variables</h2>
<p>If we want to rename variables, we can use the <code>rename()</code> function with the argument structure <code>new name = old name</code>. For example, we can rename the <code>Student_Age</code> variable to <code>age</code> and the <code>Weekly_Study_Hours</code> variable to <code>weekly_hours</code>, we can use the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>student <span class="sc">|&gt;</span> </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">age =</span> Student_Age, <span class="at">weekly_hours =</span> Weekly_Study_Hours)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 145 × 15
      Id   age Sex    High_School_Type Scholarship Additional_Work
   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;            &lt;chr&gt;       &lt;chr&gt;          
 1  5001    21 Male   Other            50%         Yes            
 2  5002    20 Male   Other            50%         Yes            
 3  5003    21 Male   State            50%         No             
 4  5004    18 Female Private          50%         Yes            
 5  5005    22 Male   Private          50%         No             
 6  5006    20 Male   State            50%         No             
 7  5007    18 Male   State            75%         No             
 8  5008    18 Female State            50%         Yes            
 9  5009    19 Female Other            50%         No             
10  5010    21 Female State            50%         No             
# ℹ 135 more rows
# ℹ 9 more variables: Sports_activity &lt;chr&gt;, Transportation &lt;chr&gt;,
#   weekly_hours &lt;dbl&gt;, Attendance &lt;chr&gt;, Reading &lt;chr&gt;, Notes &lt;chr&gt;,
#   Listening_in_Class &lt;chr&gt;, Project_work &lt;chr&gt;, Grade &lt;chr&gt;</code></pre>
</div>
</div>
</section>
<section id="categorical-variables-as-factors" class="level2">
<h2 class="anchored" data-anchor-id="categorical-variables-as-factors">Categorical variables as factors</h2>
<p>It is often useful to clearly define the levels of a categorical variable, especially if these levels have a meaningful ordering. For unordered categories, R provides the data type <code>factor</code>, while for ordered variables the relevant data type is <code>ordered</code>. Factor and ordered values appear as character strings when viewed, but are treated as numbers with labels internally, which makes it easier to show descriptives of the variable and include it in models. For example, we can define <code>High_School_Type</code> as a factor with three levels and <code>Attendance</code> as ordered with the <code>factor()</code> and <code>ordered()</code> functions. If we don’t specify the levels of the factor explicitly, then the levels will be sorted alphabetically.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>student <span class="sc">|&gt;</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">High_School_Type =</span> <span class="fu">factor</span>(High_School_Type),</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">Attendance =</span> <span class="fu">ordered</span>(Attendance, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Never"</span>, <span class="st">"Sometimes"</span>, <span class="st">"Always"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(High_School_Type, Attendance) <span class="sc">|&gt;</span> </span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># view variable types and levels by looking at the structure of the data</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [145 × 2] (S3: tbl_df/tbl/data.frame)
 $ High_School_Type: Factor w/ 3 levels "Other","Private",..: 1 1 3 2 2 3 3 3 1 3 ...
 $ Attendance      : Ord.factor w/ 3 levels "Never"&lt;"Sometimes"&lt;..: 3 3 1 3 3 3 3 2 3 1 ...</code></pre>
</div>
</div>
</section>
<section id="data-cleaning-as-a-single-pipeline" class="level2">
<h2 class="anchored" data-anchor-id="data-cleaning-as-a-single-pipeline">Data cleaning as a single pipeline</h2>
<p>Until now we didn’t save any of our data wrangling steps as new objects, so the original <code>student1</code> object is still unchanged. If we want to save the cleaned data as a new object, we can assign the result of the pipe workflow to a new object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>student_subset <span class="ot">&lt;-</span> student1 <span class="sc">|&gt;</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Student_Age <span class="sc">&gt;</span> <span class="dv">21</span>) <span class="sc">|&gt;</span> </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Id, Student_Age) <span class="sc">|&gt;</span> </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Student_Age)) <span class="sc">|&gt;</span> </span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">age =</span> Student_Age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To prepare for the rest of the analysis, let’s create a new <code>data</code> object that keeps all observations, and converts some of the indicators to numeric and logical, and rename the relevant variables to convenient “snake case”:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> student <span class="sc">|&gt;</span> </span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">scholarship =</span> <span class="fu">parse_number</span>(Scholarship),</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sex =</span> <span class="fu">factor</span>(Sex),</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>         <span class="co"># testing a logical condition: creates a logical vector</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">additional_work =</span> Additional_Work <span class="sc">==</span> <span class="st">"Yes"</span>,</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">reading =</span> Reading <span class="sc">==</span> <span class="st">"Yes"</span>,</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">notes =</span> Notes <span class="sc">==</span> <span class="st">"Yes"</span>,</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">listening =</span> Listening_in_Class <span class="sc">==</span> <span class="st">"Yes"</span>,</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>         <span class="co"># case_when is an expanded if/else case: it allows multiple conditions</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>         <span class="co"># the value after the tilde (~) is the value if the condition is TRUE</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>         <span class="co"># the function goes through each condition one by one, and stops at the first TRUE one</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>         <span class="co"># if no condition is TRUE, the variable value is missing</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">grade =</span> <span class="fu">case_when</span>(</span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>           Grade <span class="sc">==</span> <span class="st">"Fail"</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>           Grade <span class="sc">==</span> <span class="st">"DD"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>           Grade <span class="sc">==</span> <span class="st">"DC"</span> <span class="sc">~</span> <span class="fl">1.5</span>,</span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>           Grade <span class="sc">==</span> <span class="st">"CC"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>           Grade <span class="sc">==</span> <span class="st">"CB"</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>           Grade <span class="sc">==</span> <span class="st">"BB"</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>           Grade <span class="sc">==</span> <span class="st">"BA"</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>           Grade <span class="sc">==</span> <span class="st">"AA"</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a>         )) <span class="sc">|&gt;</span> </span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">id =</span> Id, <span class="at">age =</span> Student_Age) <span class="sc">|&gt;</span> </span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, age, sex, scholarship, additional_work, reading, notes, listening, grade)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 UCR Data Center  •  2025
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:datacenter@ucr.nl">
      <i class="bi bi-envelope" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/ucrdatacenter">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.instagram.com/datacenterucr">
      <i class="bi bi-instagram" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>